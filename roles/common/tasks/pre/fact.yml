---
- name: Detecting Operating System
  shell: ls /run/ostree-booted
  ignore_errors: yes
  failed_when: false
  register: ostree_output

- name: set fact ansible_local.system.is_atomic
  copy:
    dest: /etc/ansible/facts.d/system.fact
    content: "{ \"is_atomic\": {{ ostree_output.rc == 0 }}"

- name: re-read facts after adding custom fact
  setup: filter=ansible_local
